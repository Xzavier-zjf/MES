<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>缓存问题修复工具</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .error-info {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
        }
        .solution {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            padding: 15px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .btn {
            background: #1890ff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn:hover {
            background: #40a9ff;
        }
        .btn-danger {
            background: #ff4d4f;
        }
        .btn-danger:hover {
            background: #ff7875;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #52c41a;
        }
        .warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #faad14;
        }
        .error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #ff4d4f;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔧 MES前端缓存问题修复工具</h1>
        
        <div class="error-info">
            <h3>❌ 检测到的问题：</h3>
            <p><strong>错误信息：</strong> ERR_CACHE_READ_FAILURE</p>
            <p><strong>影响文件：</strong></p>
            <ul>
                <li>src/stores/index.js</li>
                <li>src/components/PageAccessMonitor.vue</li>
            </ul>
            <p><strong>症状：</strong> 页面空白，资源加载失败</p>
        </div>

        <h2>🚀 快速修复方案</h2>
        
        <div class="solution">
            <h3>方案1：清除浏览器缓存</h3>
            <button class="btn" onclick="clearBrowserCache()">清除浏览器缓存</button>
            <p>这将指导你清除浏览器缓存和Cookie</p>
        </div>

        <div class="solution">
            <h3>方案2：强制刷新页面</h3>
            <button class="btn" onclick="forceRefresh()">强制刷新</button>
            <p>使用 Ctrl+F5 强制刷新页面</p>
        </div>

        <div class="solution">
            <h3>方案3：检查开发服务器</h3>
            <button class="btn" onclick="checkDevServer()">检查服务器状态</button>
            <p>验证开发服务器是否正常运行</p>
        </div>

        <div class="solution">
            <h3>方案4：重新启动项目</h3>
            <button class="btn btn-danger" onclick="restartProject()">重启项目指南</button>
            <p>完全重启开发环境</p>
        </div>

        <div id="status"></div>

        <h2>📋 详细修复步骤</h2>
        <div id="steps"></div>
    </div>

    <script>
        function showStatus(message, type = 'success') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearBrowserCache() {
            const steps = `
                <div class="solution">
                    <h4>清除浏览器缓存步骤：</h4>
                    <ol>
                        <li>按 <code>Ctrl + Shift + Delete</code> 打开清除浏览器数据</li>
                        <li>选择时间范围：<strong>全部时间</strong></li>
                        <li>勾选：
                            <ul>
                                <li>✅ 缓存的图片和文件</li>
                                <li>✅ Cookie 和其他网站数据</li>
                                <li>✅ 托管应用数据</li>
                            </ul>
                        </li>
                        <li>点击 <strong>清除数据</strong></li>
                        <li>重新访问页面</li>
                    </ol>
                </div>
            `;
            document.getElementById('steps').innerHTML = steps;
            showStatus('✅ 已显示清除缓存步骤，请按照指引操作', 'success');
        }

        function forceRefresh() {
            const steps = `
                <div class="solution">
                    <h4>强制刷新步骤：</h4>
                    <ol>
                        <li>按 <code>F12</code> 打开开发者工具</li>
                        <li>右键点击浏览器刷新按钮</li>
                        <li>选择 <strong>"清空缓存并硬性重新加载"</strong></li>
                        <li>或者直接按 <code>Ctrl + Shift + R</code></li>
                    </ol>
                    <p><button class="btn" onclick="location.reload(true)">立即强制刷新</button></p>
                </div>
            `;
            document.getElementById('steps').innerHTML = steps;
            showStatus('🔄 准备强制刷新页面...', 'warning');
        }

        function checkDevServer() {
            const steps = `
                <div class="solution">
                    <h4>检查开发服务器：</h4>
                    <ol>
                        <li>打开命令行工具（CMD 或 PowerShell）</li>
                        <li>进入项目目录：<code>cd mes-frontend</code></li>
                        <li>检查是否有进程占用端口：<code>netstat -ano | findstr :5173</code></li>
                        <li>如果有进程，终止它：<code>taskkill /PID [进程ID] /F</code></li>
                        <li>重新启动开发服务器：<code>npm run dev</code></li>
                    </ol>
                    <p>开发服务器应该运行在：<strong>http://localhost:5173</strong></p>
                </div>
            `;
            document.getElementById('steps').innerHTML = steps;
            
            // 尝试检查服务器状态
            fetch('http://localhost:5173')
                .then(response => {
                    if (response.ok) {
                        showStatus('✅ 开发服务器运行正常', 'success');
                    } else {
                        showStatus('⚠️ 开发服务器响应异常', 'warning');
                    }
                })
                .catch(error => {
                    showStatus('❌ 无法连接到开发服务器，请检查是否已启动', 'error');
                });
        }

        function restartProject() {
            const steps = `
                <div class="solution">
                    <h4>重启项目完整步骤：</h4>
                    <ol>
                        <li><strong>停止当前服务：</strong>
                            <ul>
                                <li>在运行 npm run dev 的命令行窗口按 <code>Ctrl + C</code></li>
                                <li>或者关闭命令行窗口</li>
                            </ul>
                        </li>
                        <li><strong>清理项目缓存：</strong>
                            <pre>cd mes-frontend
npm cache clean --force
rm -rf node_modules/.vite
rm -rf dist</pre>
                        </li>
                        <li><strong>重新安装依赖（可选）：</strong>
                            <pre>npm install</pre>
                        </li>
                        <li><strong>重新启动开发服务器：</strong>
                            <pre>npm run dev</pre>
                        </li>
                        <li><strong>清除浏览器缓存并访问：</strong>
                            <ul>
                                <li>按 <code>Ctrl + Shift + Delete</code> 清除缓存</li>
                                <li>访问 <code>http://localhost:5173</code></li>
                            </ul>
                        </li>
                    </ol>
                </div>
            `;
            document.getElementById('steps').innerHTML = steps;
            showStatus('📋 已显示完整重启步骤，请按照指引操作', 'warning');
        }

        // 页面加载时自动检查
        window.onload = function() {
            showStatus('🔍 缓存问题修复工具已加载，请选择合适的修复方案', 'success');
        };
    </script>
</body>
</html>