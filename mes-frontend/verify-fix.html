<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾æ¡ˆé¢„è§ˆä¿®å¤éªŒè¯</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }

        .header {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }

        .test-section {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .test-title {
            color: #333;
            border-bottom: 2px solid #667eea;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .test-item {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
            background: #fafafa;
        }

        .test-item.success {
            border-color: #67c23a;
            background: #f0f9ff;
        }

        .test-item.error {
            border-color: #f56c6c;
            background: #fef0f0;
        }

        .test-item.loading {
            border-color: #e6a23c;
            background: #fdf6ec;
        }

        .image-preview {
            width: 100%;
            max-width: 200px;
            height: 150px;
            object-fit: cover;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-top: 10px;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .status-success {
            background: #67c23a;
            color: white;
        }

        .status-error {
            background: #f56c6c;
            color: white;
        }

        .status-loading {
            background: #e6a23c;
            color: white;
        }

        .url-info {
            font-family: monospace;
            font-size: 11px;
            color: #666;
            word-break: break-all;
            margin: 5px 0;
        }

        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: background 0.3s;
        }

        button:hover {
            background: #5a67d8;
        }

        button.success {
            background: #67c23a;
        }

        button.danger {
            background: #f56c6c;
        }

        .summary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
            text-align: center;
        }

        .summary h3 {
            margin-top: 0;
        }

        .stats {
            display: flex;
            justify-content: space-around;
            margin-top: 15px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }
    </style>
</head>

<body>
    <div class="header">
        <h1>ğŸ¨ å›¾æ¡ˆé¢„è§ˆä¿®å¤éªŒè¯</h1>
        <p>éªŒè¯å°åˆ·å›¾æ¡ˆç®¡ç†é¡µé¢çš„é¢„è§ˆå›¾æ˜¾ç¤ºé—®é¢˜æ˜¯å¦å·²ä¿®å¤</p>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ”§ ä¿®å¤çŠ¶æ€æ£€æŸ¥</h2>
        <button onclick="runFullVerification()" class="success">ğŸš€ è¿è¡Œå®Œæ•´éªŒè¯</button>
        <button onclick="testProblematicImages()">ğŸ” æµ‹è¯•é—®é¢˜å›¾ç‰‡</button>
        <button onclick="testUrlEncoding()">ğŸ”¤ æµ‹è¯•URLç¼–ç </button>
        <button onclick="clearResults()">ğŸ—‘ï¸ æ¸…é™¤ç»“æœ</button>

        <div id="testResults" class="test-grid"></div>
    </div>

    <div class="test-section">
        <h2 class="test-title">ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡</h2>
        <div id="summary" class="summary" style="display: none;">
            <h3>éªŒè¯å®Œæˆ</h3>
            <div class="stats">
                <div class="stat-item">
                    <span id="totalTests" class="stat-number">0</span>
                    <span>æ€»æµ‹è¯•æ•°</span>
                </div>
                <div class="stat-item">
                    <span id="passedTests" class="stat-number">0</span>
                    <span>é€šè¿‡æµ‹è¯•</span>
                </div>
                <div class="stat-item">
                    <span id="failedTests" class="stat-number">0</span>
                    <span>å¤±è´¥æµ‹è¯•</span>
                </div>
                <div class="stat-item">
                    <span id="successRate" class="stat-number">0%</span>
                    <span>æˆåŠŸç‡</span>
                </div>
            </div>
            <div id="finalResult" style="margin-top: 20px; font-size: 18px; font-weight: bold;"></div>
        </div>
    </div>

    <script>
        // æµ‹è¯•æ•°æ®
        const testImages = [
            {
                name: 'é—®é¢˜å›¾ç‰‡1 - åŒ…å«ç©ºæ ¼',
                path: '/uploads/patterns/4106e9db-40d5-4922-96d8-3240a6c99e3f_R-C (1).jpg',
                description: 'ä¹‹å‰404çš„å›¾ç‰‡ï¼ŒåŒ…å«ç©ºæ ¼å’Œæ‹¬å·',
                critical: true
            },
            {
                name: 'é—®é¢˜å›¾ç‰‡2 - å¤æ‚UUID',
                path: '/uploads/patterns/819aad2c-5506-4a54-9288-1836982876ed_2126.png_860.png',
                description: 'ä¹‹å‰404çš„å›¾ç‰‡ï¼Œå¤æ‚æ–‡ä»¶å',
                critical: true
            },
            {
                name: 'é—®é¢˜å›¾ç‰‡3 - UUIDç®€åŒ–',
                path: '/uploads/patterns/deeaa61e-3742-40dc-9e41-3507caf50e5e_R-C.jpg',
                description: 'UUIDåŠ çŸ­åç§°',
                critical: true
            },
            {
                name: 'æµ‹è¯•å›¾ç‰‡1',
                path: '/uploads/patterns/test-pattern-1.jpg',
                description: 'æ–°åˆ›å»ºçš„æµ‹è¯•å›¾ç‰‡',
                critical: false
            },
            {
                name: 'æµ‹è¯•å›¾ç‰‡2',
                path: '/uploads/patterns/test-pattern-2.png',
                description: 'æ–°åˆ›å»ºçš„æµ‹è¯•å›¾ç‰‡',
                critical: false
            },
            {
                name: 'å‡ ä½•å›¾æ¡ˆ',
                path: '/uploads/patterns/geometric-pattern.jpg',
                description: 'å‡ ä½•å›¾æ¡ˆæµ‹è¯•',
                critical: false
            }
        ];

        let testStats = {
            total: 0,
            passed: 0,
            failed: 0
        };

        // æ¨¡æ‹ŸgetImageUrlå‡½æ•°
        function getImageUrl(path) {
            if (!path) return ''

            if (path.startsWith('http://') || path.startsWith('https://')) {
                return path
            }

            const baseUrl = 'http://localhost:8080'
            let processedPath = path

            if (path.startsWith('/uploads/')) {
                processedPath = path
            } else if (path.startsWith('/')) {
                processedPath = path
            } else {
                processedPath = `/uploads/patterns/${path}`
            }

            const pathParts = processedPath.split('/')
            const encodedParts = pathParts.map((part, index) => {
                if (index === pathParts.length - 1 && part) {
                    return encodeURIComponent(part)
                }
                return part
            })

            const encodedPath = encodedParts.join('/')
            return `${baseUrl}/api${encodedPath}`
        }

        // åˆ›å»ºæµ‹è¯•é¡¹
        function createTestItem(imageData) {
            const item = document.createElement('div');
            item.className = 'test-item loading';

            const badge = document.createElement('div');
            badge.className = 'status-badge status-loading';
            badge.textContent = 'æµ‹è¯•ä¸­...';

            const title = document.createElement('h4');
            title.textContent = imageData.name;
            title.style.margin = '0 0 10px 0';

            const description = document.createElement('p');
            description.textContent = imageData.description;
            description.style.margin = '0 0 10px 0';
            description.style.fontSize = '14px';
            description.style.color = '#666';

            const pathInfo = document.createElement('div');
            pathInfo.className = 'url-info';
            pathInfo.textContent = `åŸå§‹è·¯å¾„: ${imageData.path}`;

            const urlInfo = document.createElement('div');
            urlInfo.className = 'url-info';

            const img = document.createElement('img');
            img.className = 'image-preview';
            img.alt = imageData.name;
            img.style.display = 'none';

            item.appendChild(badge);
            item.appendChild(title);
            item.appendChild(description);
            item.appendChild(pathInfo);
            item.appendChild(urlInfo);
            item.appendChild(img);

            return { item, badge, urlInfo, img };
        }

        // æµ‹è¯•å•ä¸ªå›¾ç‰‡
        async function testSingleImage(imageData, container) {
            const { item, badge, urlInfo, img } = createTestItem(imageData);
            container.appendChild(item);

            testStats.total++;

            try {
                const imageUrl = getImageUrl(imageData.path);
                urlInfo.textContent = `ç”ŸæˆURL: ${imageUrl}`;

                // æµ‹è¯•å›¾ç‰‡è®¿é—®
                const response = await fetch(imageUrl, { method: 'HEAD' });

                if (response.ok) {
                    // æˆåŠŸ
                    item.className = 'test-item success';
                    badge.className = 'status-badge status-success';
                    badge.textContent = `âœ… æˆåŠŸ (${response.status})`;

                    // æ˜¾ç¤ºå›¾ç‰‡
                    img.src = imageUrl;
                    img.style.display = 'block';

                    img.onload = () => {
                        console.log(`å›¾ç‰‡åŠ è½½æˆåŠŸ: ${imageData.name}`);
                    };

                    img.onerror = () => {
                        badge.textContent = `âš ï¸ è®¿é—®æˆåŠŸä½†æ˜¾ç¤ºå¤±è´¥`;
                        badge.className = 'status-badge status-error';
                    };

                    testStats.passed++;

                } else {
                    // å¤±è´¥
                    item.className = 'test-item error';
                    badge.className = 'status-badge status-error';
                    badge.textContent = `âŒ HTTP ${response.status}`;
                    testStats.failed++;
                }

            } catch (error) {
                // é”™è¯¯
                item.className = 'test-item error';
                badge.className = 'status-badge status-error';
                badge.textContent = `âŒ ç½‘ç»œé”™è¯¯`;

                const errorInfo = document.createElement('div');
                errorInfo.className = 'url-info';
                errorInfo.textContent = `é”™è¯¯: ${error.message}`;
                errorInfo.style.color = '#f56c6c';
                item.appendChild(errorInfo);

                testStats.failed++;
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            document.getElementById('totalTests').textContent = testStats.total;
            document.getElementById('passedTests').textContent = testStats.passed;
            document.getElementById('failedTests').textContent = testStats.failed;

            const successRate = testStats.total > 0 ? Math.round((testStats.passed / testStats.total) * 100) : 0;
            document.getElementById('successRate').textContent = successRate + '%';

            const finalResult = document.getElementById('finalResult');
            const criticalTests = testImages.filter(img => img.critical);
            const criticalPassed = testStats.passed >= criticalTests.length;

            if (successRate === 100) {
                finalResult.textContent = 'ğŸ‰ æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼å›¾æ¡ˆé¢„è§ˆåŠŸèƒ½å·²å®Œå…¨ä¿®å¤ï¼';
                finalResult.style.color = '#67c23a';
            } else if (criticalPassed && successRate >= 80) {
                finalResult.textContent = 'âœ… å…³é”®åŠŸèƒ½å·²ä¿®å¤ï¼Œéƒ¨åˆ†æµ‹è¯•é€šè¿‡';
                finalResult.style.color = '#e6a23c';
            } else {
                finalResult.textContent = 'âŒ ä¿®å¤ä¸å®Œæ•´ï¼Œéœ€è¦è¿›ä¸€æ­¥å¤„ç†';
                finalResult.style.color = '#f56c6c';
            }

            document.getElementById('summary').style.display = 'block';
        }

        // è¿è¡Œå®Œæ•´éªŒè¯
        async function runFullVerification() {
            clearResults();
            const container = document.getElementById('testResults');

            console.log('å¼€å§‹è¿è¡Œå®Œæ•´éªŒè¯...');

            for (const imageData of testImages) {
                await testSingleImage(imageData, container);
                await new Promise(resolve => setTimeout(resolve, 500));
            }

            updateStats();
            console.log('å®Œæ•´éªŒè¯å®Œæˆ');
        }

        // æµ‹è¯•é—®é¢˜å›¾ç‰‡
        async function testProblematicImages() {
            clearResults();
            const container = document.getElementById('testResults');

            const problematicImages = testImages.filter(img => img.critical);

            for (const imageData of problematicImages) {
                await testSingleImage(imageData, container);
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            updateStats();
        }

        // æµ‹è¯•URLç¼–ç 
        async function testUrlEncoding() {
            clearResults();
            const container = document.getElementById('testResults');

            const encodingTests = [
                {
                    name: 'URLç¼–ç æµ‹è¯• - ç©ºæ ¼',
                    path: '/uploads/patterns/4106e9db-40d5-4922-96d8-3240a6c99e3f_R-C (1).jpg',
                    description: 'æµ‹è¯•ç©ºæ ¼å­—ç¬¦çš„URLç¼–ç å¤„ç†',
                    critical: true
                },
                {
                    name: 'URLç¼–ç æµ‹è¯• - å¤æ‚å­—ç¬¦',
                    path: '/uploads/patterns/819aad2c-5506-4a54-9288-1836982876ed_2126.png_860.png',
                    description: 'æµ‹è¯•å¤æ‚æ–‡ä»¶åçš„å¤„ç†',
                    critical: true
                }
            ];

            for (const imageData of encodingTests) {
                await testSingleImage(imageData, container);
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            updateStats();
        }

        // æ¸…é™¤ç»“æœ
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').style.display = 'none';
            testStats = { total: 0, passed: 0, failed: 0 };
        }

        // é¡µé¢åŠ è½½å®Œæˆåè‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        document.addEventListener('DOMContentLoaded', function () {
            console.log('å›¾æ¡ˆé¢„è§ˆä¿®å¤éªŒè¯å·¥å…·å·²åŠ è½½');

            // 3ç§’åè‡ªåŠ¨è¿è¡ŒéªŒè¯
            setTimeout(() => {
                console.log('è‡ªåŠ¨å¼€å§‹éªŒè¯...');
                runFullVerification();
            }, 2000);
        });
    </script>
</body>

</html>