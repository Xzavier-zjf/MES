# å°åˆ·å›¾æ¡ˆé¢„è§ˆå›¾ä¸æ˜¾ç¤ºé—®é¢˜ä¿®å¤æ–¹æ¡ˆ

## ğŸ” é—®é¢˜åˆ†æ

### å½“å‰é—®é¢˜
1. **å›¾ç‰‡URLé…ç½®é”™è¯¯**ï¼šå‰ç«¯ä½¿ç”¨ `http://localhost:7000` ä½†å®é™…åº”è¯¥æ˜¯ `http://localhost:8080`
2. **é™æ€èµ„æºæœåŠ¡å™¨æœªé…ç½®**ï¼šåç«¯æ²¡æœ‰é…ç½®é™æ€èµ„æºè®¿é—®è·¯å¾„
3. **ä¸Šä¼ åŠŸèƒ½ä¸å®Œæ•´**ï¼šç¼ºå°‘æ–‡ä»¶ä¸Šä¼ çš„åç«¯å®ç°

### æ•°æ®åº“ç°çŠ¶
- è¡¨åï¼š`print_pattern`
- å›¾ç‰‡å­—æ®µï¼š`image_url` (varchar(255))
- ç°æœ‰æ•°æ®ç¤ºä¾‹ï¼š`/uploads/patterns/xxx.jpg`

## ğŸ› ï¸ è§£å†³æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šä¿®å¤å‰ç«¯å›¾ç‰‡URLé…ç½®ï¼ˆæ¨èï¼‰

#### 1.1 ä¿®æ”¹å‰ç«¯å›¾ç‰‡æ˜¾ç¤ºé€»è¾‘
```javascript
// ä¿®æ”¹ PatternManager.vue ä¸­çš„å›¾ç‰‡æ˜¾ç¤º
<el-image 
  :src="getImageUrl(row.imageUrl)" 
  fit="cover" 
  style="width: 60px; height: 60px"
  :preview-src-list="row.imageUrl ? [getImageUrl(row.imageUrl)] : []"
/>

// æ·»åŠ å›¾ç‰‡URLå¤„ç†æ–¹æ³•
const getImageUrl = (imageUrl) => {
  if (!imageUrl) return ''
  
  // å¦‚æœæ˜¯å®Œæ•´URLï¼Œç›´æ¥è¿”å›
  if (imageUrl.startsWith('http://') || imageUrl.startsWith('https://')) {
    return imageUrl
  }
  
  // å¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œæ‹¼æ¥æ­£ç¡®çš„åŸºç¡€URL
  return `http://localhost:8080${imageUrl}`
}
```

#### 1.2 ä¿®æ”¹ä¸Šä¼ APIé…ç½®
```javascript
// ä¿®æ”¹ upload.js ä¸­çš„getImageUrlæ–¹æ³•
export const getImageUrl = (path) => {
  if (!path) return ''
  
  if (path.startsWith('http://') || path.startsWith('https://')) {
    return path
  }
  
  // ä½¿ç”¨æ­£ç¡®çš„ç«¯å£
  const baseUrl = 'http://localhost:8080'
  return `${baseUrl}${path}`
}
```

### æ–¹æ¡ˆ2ï¼šé…ç½®åç«¯é™æ€èµ„æºæœåŠ¡

#### 2.1 åˆ›å»ºä¸Šä¼ æ§åˆ¶å™¨
```java
@RestController
@RequestMapping("/api/upload")
@CrossOrigin(origins = {"http://localhost:5173"})
public class UploadController {
    
    private static final String UPLOAD_DIR = "uploads/patterns/";
    
    @PostMapping("/image")
    public ResponseEntity<?> uploadImage(@RequestParam("file") MultipartFile file) {
        try {
            // åˆ›å»ºä¸Šä¼ ç›®å½•
            Path uploadPath = Paths.get(UPLOAD_DIR);
            if (!Files.exists(uploadPath)) {
                Files.createDirectories(uploadPath);
            }
            
            // ç”Ÿæˆå”¯ä¸€æ–‡ä»¶å
            String originalFilename = file.getOriginalFilename();
            String extension = originalFilename.substring(originalFilename.lastIndexOf("."));
            String filename = UUID.randomUUID().toString() + "_" + originalFilename;
            
            // ä¿å­˜æ–‡ä»¶
            Path filePath = uploadPath.resolve(filename);
            Files.copy(file.getInputStream(), filePath, StandardCopyOption.REPLACE_EXISTING);
            
            // è¿”å›æ–‡ä»¶è·¯å¾„
            Map<String, Object> result = new HashMap<>();
            result.put("success", true);
            result.put("url", "/" + UPLOAD_DIR + filename);
            result.put("path", "/" + UPLOAD_DIR + filename);
            
            return ResponseEntity.ok(result);
        } catch (Exception e) {
            Map<String, Object> error = new HashMap<>();
            error.put("success", false);
            error.put("message", "æ–‡ä»¶ä¸Šä¼ å¤±è´¥: " + e.getMessage());
            return ResponseEntity.status(500).body(error);
        }
    }
}
```

#### 2.2 é…ç½®é™æ€èµ„æºè®¿é—®
```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    
    @Override
    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        // é…ç½®é™æ€èµ„æºè®¿é—®è·¯å¾„
        registry.addResourceHandler("/uploads/**")
                .addResourceLocations("file:uploads/");
    }
}
```

### æ–¹æ¡ˆ3ï¼šæ•°æ®åº“ä¿®å¤è„šæœ¬

#### 3.1 æ£€æŸ¥ç°æœ‰å›¾ç‰‡æ•°æ®
```sql
-- æ£€æŸ¥ç°æœ‰å›¾æ¡ˆæ•°æ®
SELECT id, pattern_code, pattern_name, image_url 
FROM print_pattern 
WHERE image_url IS NOT NULL;

-- æ£€æŸ¥å›¾ç‰‡æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼ˆéœ€è¦åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼‰
```

#### 3.2 ä¿®å¤å›¾ç‰‡è·¯å¾„ï¼ˆå¦‚æœéœ€è¦ï¼‰
```sql
-- å¦‚æœéœ€è¦ä¿®å¤å›¾ç‰‡è·¯å¾„æ ¼å¼
UPDATE print_pattern 
SET image_url = CONCAT('/uploads/patterns/', SUBSTRING_INDEX(image_url, '/', -1))
WHERE image_url IS NOT NULL 
AND image_url NOT LIKE '/uploads/patterns/%';
```

## ğŸš€ å®æ–½æ­¥éª¤

### æ­¥éª¤1ï¼šç«‹å³ä¿®å¤å‰ç«¯æ˜¾ç¤º
1. ä¿®æ”¹ `PatternManager.vue` ä¸­çš„å›¾ç‰‡URL
2. ä¿®æ”¹ `upload.js` ä¸­çš„åŸºç¡€URL
3. é‡å¯å‰ç«¯æœåŠ¡æµ‹è¯•

### æ­¥éª¤2ï¼šé…ç½®åç«¯é™æ€èµ„æº
1. åœ¨ç½‘å…³æˆ–å·¥è‰ºæœåŠ¡ä¸­æ·»åŠ ä¸Šä¼ æ§åˆ¶å™¨
2. é…ç½®é™æ€èµ„æºè®¿é—®è·¯å¾„
3. é‡å¯åç«¯æœåŠ¡

### æ­¥éª¤3ï¼šæµ‹è¯•å®Œæ•´åŠŸèƒ½
1. æµ‹è¯•ç°æœ‰å›¾ç‰‡æ˜¾ç¤º
2. æµ‹è¯•æ–°å›¾ç‰‡ä¸Šä¼ 
3. æµ‹è¯•å›¾ç‰‡é¢„è§ˆåŠŸèƒ½

## ğŸ“‹ æµ‹è¯•æ¸…å•

- [ ] ç°æœ‰å›¾æ¡ˆçš„é¢„è§ˆå›¾æ­£å¸¸æ˜¾ç¤º
- [ ] æ–°ä¸Šä¼ å›¾ç‰‡åŠŸèƒ½æ­£å¸¸
- [ ] å›¾ç‰‡é¢„è§ˆå¼¹çª—æ­£å¸¸
- [ ] ç¼–è¾‘æ—¶å›¾ç‰‡æ­£å¸¸åŠ è½½
- [ ] ä¸åŒæ ¼å¼å›¾ç‰‡éƒ½èƒ½æ­£å¸¸æ˜¾ç¤º

## ğŸ”§ æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šå›¾ç‰‡ä»ç„¶ä¸æ˜¾ç¤º
- æ£€æŸ¥ç½‘ç»œè¯·æ±‚æ˜¯å¦è¿”å›404
- ç¡®è®¤åç«¯é™æ€èµ„æºé…ç½®
- æ£€æŸ¥æ–‡ä»¶æƒé™

### é—®é¢˜2ï¼šä¸Šä¼ å¤±è´¥
- æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
- ç¡®è®¤æ–‡ä»¶å¤§å°é™åˆ¶
- æŸ¥çœ‹åç«¯æ—¥å¿—

### é—®é¢˜3ï¼šè·¨åŸŸé—®é¢˜
- ç¡®è®¤CORSé…ç½®
- æ£€æŸ¥è¯·æ±‚å¤´è®¾ç½®