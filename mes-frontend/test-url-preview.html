<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾ç‰‡URLé¢„è§ˆæµ‹è¯•</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .url-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            margin: 10px 0;
        }
        .preview-area {
            margin-top: 20px;
            padding: 20px;
            border: 1px solid #e4e7ed;
            border-radius: 6px;
            background: #fafafa;
            min-height: 200px;
        }
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            border-radius: 4px;
            border: 1px solid #ddd;
        }
        .error-message {
            color: #ff4d4f;
            font-size: 14px;
            margin-top: 10px;
        }
        .success-message {
            color: #52c41a;
            font-size: 14px;
            margin-top: 10px;
        }
        .test-urls {
            background: #f0f9ff;
            padding: 15px;
            border-radius: 4px;
            margin: 15px 0;
        }
        .test-urls h4 {
            margin-top: 0;
            color: #1890ff;
        }
        .url-link {
            display: block;
            color: #1890ff;
            text-decoration: none;
            padding: 5px 0;
            cursor: pointer;
        }
        .url-link:hover {
            text-decoration: underline;
        }
        .button {
            background: #409eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #66b1ff;
        }
    </style>
</head>
<body>
    <div class="test-section">
        <h1>ğŸ–¼ï¸ å›¾ç‰‡URLé¢„è§ˆåŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•å›¾æ¡ˆç®¡ç†é¡µé¢ä¸­çš„å›¾ç‰‡URLé¢„è§ˆåŠŸèƒ½</p>
    </div>

    <div class="test-section">
        <h2>ğŸ“ URLè¾“å…¥æµ‹è¯•</h2>
        <label for="urlInput">è¯·è¾“å…¥å›¾ç‰‡URLï¼š</label>
        <input 
            type="url" 
            id="urlInput" 
            class="url-input" 
            placeholder="è¯·è¾“å…¥å›¾ç‰‡URLï¼Œå¦‚: https://example.com/image.jpg"
            oninput="handleUrlInput()"
        />
        
        <div class="test-urls">
            <h4>ğŸ§ª æµ‹è¯•ç”¨å›¾ç‰‡URLï¼ˆç‚¹å‡»å¿«é€Ÿå¡«å…¥ï¼‰ï¼š</h4>
            <a class="url-link" onclick="setTestUrl('https://picsum.photos/300/200?random=1')">
                https://picsum.photos/300/200?random=1 (éšæœºå›¾ç‰‡1)
            </a>
            <a class="url-link" onclick="setTestUrl('https://picsum.photos/300/200?random=2')">
                https://picsum.photos/300/200?random=2 (éšæœºå›¾ç‰‡2)
            </a>
            <a class="url-link" onclick="setTestUrl('https://via.placeholder.com/300x200/409EFF/FFFFFF?text=Test+Image')">
                https://via.placeholder.com/300x200/409EFF/FFFFFF?text=Test+Image (å ä½å›¾)
            </a>
            <a class="url-link" onclick="setTestUrl('https://httpbin.org/image/jpeg')">
                https://httpbin.org/image/jpeg (JPEGæµ‹è¯•å›¾)
            </a>
            <a class="url-link" onclick="setTestUrl('https://invalid-url-test.com/nonexistent.jpg')">
                https://invalid-url-test.com/nonexistent.jpg (æ— æ•ˆURLæµ‹è¯•)
            </a>
        </div>
        
        <button class="button" onclick="clearPreview()">æ¸…é™¤é¢„è§ˆ</button>
        <button class="button" onclick="testPatternManager()">åœ¨å›¾æ¡ˆç®¡ç†ä¸­æµ‹è¯•</button>
    </div>

    <div class="test-section">
        <h2>ğŸ‘ï¸ é¢„è§ˆåŒºåŸŸ</h2>
        <div id="previewArea" class="preview-area">
            <div id="previewContent">
                <p style="text-align: center; color: #999; margin-top: 80px;">
                    è¯·è¾“å…¥å›¾ç‰‡URLæŸ¥çœ‹é¢„è§ˆæ•ˆæœ
                </p>
            </div>
        </div>
        <div id="statusMessage"></div>
    </div>

    <div class="test-section">
        <h2>ğŸ”§ è°ƒè¯•ä¿¡æ¯</h2>
        <div id="debugInfo" style="background: #f5f5f5; padding: 15px; border-radius: 4px; font-family: monospace; font-size: 12px;">
            ç­‰å¾…è¾“å…¥URL...
        </div>
    </div>

    <script>
        let currentUrl = '';
        let previewTimeout = null;

        function handleUrlInput() {
            const input = document.getElementById('urlInput');
            const url = input.value.trim();
            
            // æ¸…é™¤ä¹‹å‰çš„å®šæ—¶å™¨
            if (previewTimeout) {
                clearTimeout(previewTimeout);
            }
            
            // æ›´æ–°è°ƒè¯•ä¿¡æ¯
            updateDebugInfo('URLè¾“å…¥', { url, length: url.length });
            
            if (!url) {
                clearPreview();
                return;
            }
            
            // å»¶è¿Ÿé¢„è§ˆï¼Œé¿å…é¢‘ç¹æ›´æ–°
            previewTimeout = setTimeout(() => {
                previewImage(url);
            }, 500);
        }

        function previewImage(url) {
            currentUrl = url;
            const previewContent = document.getElementById('previewContent');
            const statusMessage = document.getElementById('statusMessage');
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            previewContent.innerHTML = `
                <div style="text-align: center; padding: 40px;">
                    <div style="font-size: 24px; margin-bottom: 10px;">â³</div>
                    <div>æ­£åœ¨åŠ è½½å›¾ç‰‡...</div>
                </div>
            `;
            statusMessage.innerHTML = '';
            
            updateDebugInfo('å¼€å§‹é¢„è§ˆ', { url });
            
            // åˆ›å»ºå›¾ç‰‡å…ƒç´ è¿›è¡Œé¢„åŠ è½½
            const img = new Image();
            
            img.onload = function() {
                previewContent.innerHTML = `
                    <div style="text-align: center;">
                        <img src="${url}" class="preview-image" alt="é¢„è§ˆå›¾ç‰‡" />
                        <div style="margin-top: 10px; font-size: 12px; color: #666;">
                            å°ºå¯¸: ${this.naturalWidth} Ã— ${this.naturalHeight}
                        </div>
                    </div>
                `;
                statusMessage.innerHTML = '<div class="success-message">âœ… å›¾ç‰‡åŠ è½½æˆåŠŸ</div>';
                updateDebugInfo('åŠ è½½æˆåŠŸ', { 
                    url, 
                    width: this.naturalWidth, 
                    height: this.naturalHeight,
                    size: `${this.naturalWidth} Ã— ${this.naturalHeight}`
                });
            };
            
            img.onerror = function() {
                previewContent.innerHTML = `
                    <div style="text-align: center; padding: 40px;">
                        <div style="font-size: 24px; margin-bottom: 10px; color: #ff4d4f;">âŒ</div>
                        <div style="color: #ff4d4f;">å›¾ç‰‡åŠ è½½å¤±è´¥</div>
                        <div style="font-size: 12px; color: #999; margin-top: 10px;">
                            è¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®æˆ–å›¾ç‰‡æ˜¯å¦å­˜åœ¨
                        </div>
                    </div>
                `;
                statusMessage.innerHTML = '<div class="error-message">âŒ å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥URLæ˜¯å¦æ­£ç¡®</div>';
                updateDebugInfo('åŠ è½½å¤±è´¥', { url, error: 'å›¾ç‰‡æ— æ³•åŠ è½½' });
            };
            
            // å¼€å§‹åŠ è½½å›¾ç‰‡
            img.src = url;
        }

        function setTestUrl(url) {
            document.getElementById('urlInput').value = url;
            handleUrlInput();
        }

        function clearPreview() {
            document.getElementById('urlInput').value = '';
            document.getElementById('previewContent').innerHTML = `
                <p style="text-align: center; color: #999; margin-top: 80px;">
                    è¯·è¾“å…¥å›¾ç‰‡URLæŸ¥çœ‹é¢„è§ˆæ•ˆæœ
                </p>
            `;
            document.getElementById('statusMessage').innerHTML = '';
            updateDebugInfo('æ¸…é™¤é¢„è§ˆ', {});
            currentUrl = '';
        }

        function updateDebugInfo(action, data) {
            const debugInfo = document.getElementById('debugInfo');
            const timestamp = new Date().toLocaleTimeString();
            debugInfo.innerHTML = `
                <strong>æœ€åæ“ä½œ:</strong> ${action} (${timestamp})<br>
                <strong>å½“å‰URL:</strong> ${currentUrl || 'æ— '}<br>
                <strong>URLé•¿åº¦:</strong> ${currentUrl.length}<br>
                <strong>æ•°æ®:</strong> ${JSON.stringify(data, null, 2)}
            `;
        }

        function testPatternManager() {
            if (currentUrl) {
                // å°†URLä¿å­˜åˆ°localStorageï¼Œåœ¨å›¾æ¡ˆç®¡ç†é¡µé¢ä¸­ä½¿ç”¨
                localStorage.setItem('testImageUrl', currentUrl);
                alert(`å·²ä¿å­˜æµ‹è¯•URLåˆ°æœ¬åœ°å­˜å‚¨ï¼š${currentUrl}\n\nç°åœ¨æ‰“å¼€å›¾æ¡ˆç®¡ç†é¡µé¢ï¼Œåœ¨ç¼–è¾‘å¯¹è¯æ¡†ä¸­é€‰æ‹©"å›¾ç‰‡URL"æ–¹å¼ï¼ŒURLä¼šè‡ªåŠ¨å¡«å…¥ã€‚`);
                window.open('/pattern', '_blank');
            } else {
                alert('è¯·å…ˆè¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„å›¾ç‰‡URL');
            }
        }

        // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥æ˜¯å¦æœ‰ä¿å­˜çš„æµ‹è¯•URL
        document.addEventListener('DOMContentLoaded', function() {
            const savedUrl = localStorage.getItem('testImageUrl');
            if (savedUrl) {
                document.getElementById('urlInput').value = savedUrl;
                handleUrlInput();
            }
            
            console.log('ğŸ–¼ï¸ å›¾ç‰‡URLé¢„è§ˆæµ‹è¯•é¡µé¢å·²åŠ è½½');
            updateDebugInfo('é¡µé¢åˆå§‹åŒ–', { savedUrl: savedUrl || 'æ— ' });
        });
    </script>
</body>
</html>