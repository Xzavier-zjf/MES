<!DOCTYPE html>
<html>
<head>
    <title>ä»»åŠ¡æ•°é‡æ›´æ–°åŠŸèƒ½æµ‹è¯•</title>
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .result { background: #f5f5f5; padding: 10px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; margin-top: 10px; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
        input, select { padding: 5px; margin: 5px; width: 200px; }
        label { display: inline-block; width: 120px; }
        .feature-demo { background: #f0f9ff; padding: 15px; border-radius: 8px; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ä»»åŠ¡æ•°é‡æ›´æ–°åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="feature-demo">
        <h3>ğŸ¯ æ–°åŠŸèƒ½è¯´æ˜</h3>
        <ul>
            <li><strong>ç¼–è¾‘æ¨¡å¼å¢å¼º</strong>ï¼šåœ¨ç¼–è¾‘å·¥è‰ºå‚æ•°æ—¶å¯ä»¥åŒæ—¶æ›´æ–°ä»»åŠ¡æ•°é‡</li>
            <li><strong>æ•°é‡åŒæ­¥</strong>ï¼šæ”¯æŒå°†ä»»åŠ¡æ•°é‡åŒæ­¥åˆ°å·¥è‰ºå‚æ•°æ•°é‡</li>
            <li><strong>æƒé™æ§åˆ¶</strong>ï¼šåªæœ‰æœ‰æƒé™çš„ç”¨æˆ·æ‰èƒ½ä¿®æ”¹ä»»åŠ¡æ•°é‡</li>
            <li><strong>ç¡®è®¤æœºåˆ¶</strong>ï¼šæ›´æ–°ä»»åŠ¡æ•°é‡å‰ä¼šæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†</li>
            <li><strong>å½±å“æç¤º</strong>ï¼šæé†’ç”¨æˆ·æ›´æ–°ä»»åŠ¡æ•°é‡å¯èƒ½å½±å“å…¶ä»–å·¥è‰ºå‚æ•°</li>
        </ul>
    </div>
    
    <div class="test-section">
        <h3>1. è·å–ä»»åŠ¡åˆ—è¡¨</h3>
        <button onclick="fetchTasks()">è·å–ä»»åŠ¡åˆ—è¡¨</button>
        <div id="tasksList" class="result"></div>
    </div>

    <div class="test-section">
        <h3>2. æµ‹è¯•ä»»åŠ¡æ•°é‡æ›´æ–°</h3>
        <div>
            <label>ä»»åŠ¡ID: <input type="text" id="taskId" placeholder="è¾“å…¥ä»»åŠ¡ID"></label><br>
            <label>æ–°æ•°é‡: <input type="number" id="newQuantity" placeholder="è¾“å…¥æ–°æ•°é‡" min="1"></label><br>
        </div>
        <button onclick="testUpdateTaskQuantity()">æµ‹è¯•æ›´æ–°ä»»åŠ¡æ•°é‡</button>
        <div id="updateResult" class="result"></div>
    </div>

    <div class="test-section">
        <h3>3. è·å–æ³¨å¡‘å‚æ•°åˆ—è¡¨</h3>
        <button onclick="fetchInjectionParams()">è·å–æ³¨å¡‘å‚æ•°åˆ—è¡¨</button>
        <div id="paramsList" class="result"></div>
    </div>

    <div class="test-section">
        <h3>4. åŠŸèƒ½æ¼”ç¤ºåœºæ™¯</h3>
        <div class="feature-demo">
            <h4>å…¸å‹ä½¿ç”¨åœºæ™¯ï¼š</h4>
            <ol>
                <li>åœ¨æ³¨å¡‘å·¥è‰ºå‚æ•°é¡µé¢ç‚¹å‡»"å½•å…¥å·¥è‰º"æŒ‰é’®</li>
                <li>åœ¨ç¼–è¾‘å¯¹è¯æ¡†ä¸­çœ‹åˆ°å½“å‰ä»»åŠ¡æ•°é‡</li>
                <li>ä¿®æ”¹ä»»åŠ¡æ•°é‡å¹¶å‹¾é€‰"åŒæ—¶æ›´æ–°ä»»åŠ¡æ•°é‡"</li>
                <li>ç‚¹å‡»"æ›´æ–°å·¥è‰ºå‚æ•°"æŒ‰é’®</li>
                <li>ç³»ç»Ÿæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†</li>
                <li>ç¡®è®¤ååŒæ—¶æ›´æ–°å·¥è‰ºå‚æ•°å’Œä»»åŠ¡æ•°é‡</li>
            </ol>
        </div>
        <button onclick="simulateWorkflow()">æ¨¡æ‹Ÿå®Œæ•´å·¥ä½œæµç¨‹</button>
        <div id="workflowResult" class="result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        
        async function fetchTasks() {
            const resultDiv = document.getElementById('tasksList');
            
            try {
                resultDiv.innerHTML = 'è·å–ä»»åŠ¡åˆ—è¡¨ä¸­...';
                
                const response = await fetch(`${API_BASE}/api/v1/production/tasks?page=0&size=10`);
                const responseData = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = 'âœ… è·å–æˆåŠŸ!\n\n' + JSON.stringify(responseData, null, 2);
                    
                    // è‡ªåŠ¨å¡«å……ç¬¬ä¸€ä¸ªä»»åŠ¡ID
                    if (responseData.content && responseData.content.length > 0) {
                        document.getElementById('taskId').value = responseData.content[0].id;
                        document.getElementById('newQuantity').value = (responseData.content[0].quantity || 100) + 50;
                    }
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = 'âŒ è·å–å¤±è´¥!\n\nçŠ¶æ€ç : ' + response.status + 
                                         '\n\né”™è¯¯å“åº”:\n' + JSON.stringify(responseData, null, 2);
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯!\n\n' + error.message;
            }
        }
        
        async function testUpdateTaskQuantity() {
            const taskId = document.getElementById('taskId').value;
            const newQuantity = parseInt(document.getElementById('newQuantity').value);
            const resultDiv = document.getElementById('updateResult');
            
            if (!taskId || !newQuantity) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥ä»»åŠ¡IDå’Œæ–°æ•°é‡';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'æ›´æ–°ä»»åŠ¡æ•°é‡ä¸­...';
                
                const response = await fetch(`${API_BASE}/api/v1/production/tasks/${taskId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        quantity: newQuantity
                    })
                });
                
                const responseText = await response.text();
                let responseData;
                
                try {
                    responseData = JSON.parse(responseText);
                } catch (e) {
                    responseData = responseText;
                }
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = 'âœ… ä»»åŠ¡æ•°é‡æ›´æ–°æˆåŠŸ!\n\n' +
                                         `ä»»åŠ¡ID: ${taskId}\n` +
                                         `æ–°æ•°é‡: ${newQuantity}\n\n` +
                                         'å“åº”æ•°æ®:\n' + JSON.stringify(responseData, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = 'âŒ æ›´æ–°å¤±è´¥!\n\nçŠ¶æ€ç : ' + response.status + 
                                         '\n\né”™è¯¯å“åº”:\n' + JSON.stringify(responseData, null, 2);
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯!\n\n' + error.message;
            }
        }
        
        async function fetchInjectionParams() {
            const resultDiv = document.getElementById('paramsList');
            
            try {
                resultDiv.innerHTML = 'è·å–æ³¨å¡‘å‚æ•°åˆ—è¡¨ä¸­...';
                
                const response = await fetch(`${API_BASE}/api/v1/process/injection-params/all?page=0&size=10`);
                const responseData = await response.json();
                
                if (response.ok) {
                    resultDiv.className = 'result success';
                    resultDiv.innerHTML = 'âœ… è·å–æˆåŠŸ!\n\n' + JSON.stringify(responseData, null, 2);
                } else {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = 'âŒ è·å–å¤±è´¥!\n\nçŠ¶æ€ç : ' + response.status + 
                                         '\n\né”™è¯¯å“åº”:\n' + JSON.stringify(responseData, null, 2);
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ ç½‘ç»œé”™è¯¯!\n\n' + error.message;
            }
        }
        
        async function simulateWorkflow() {
            const resultDiv = document.getElementById('workflowResult');
            resultDiv.innerHTML = 'ğŸ”„ æ¨¡æ‹Ÿå·¥ä½œæµç¨‹...\n\n';
            
            const steps = [
                '1. ç”¨æˆ·åœ¨æ³¨å¡‘å·¥è‰ºå‚æ•°é¡µé¢ç‚¹å‡»"å½•å…¥å·¥è‰º"',
                '2. ç³»ç»Ÿæ‰“å¼€ç¼–è¾‘å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºå½“å‰ä»»åŠ¡ä¿¡æ¯',
                '3. ç”¨æˆ·çœ‹åˆ°ä»»åŠ¡æ•°é‡å­—æ®µå’Œå·¥è‰ºå‚æ•°æ•°é‡',
                '4. ç”¨æˆ·ä¿®æ”¹ä»»åŠ¡æ•°é‡å¹¶å‹¾é€‰"åŒæ—¶æ›´æ–°ä»»åŠ¡æ•°é‡"',
                '5. ç”¨æˆ·ç‚¹å‡»"æ›´æ–°å·¥è‰ºå‚æ•°"æŒ‰é’®',
                '6. ç³»ç»Ÿæ˜¾ç¤ºç¡®è®¤å¯¹è¯æ¡†ï¼šç¡®è®¤æ›´æ–°ä»»åŠ¡æ•°é‡',
                '7. ç”¨æˆ·ç¡®è®¤åï¼Œç³»ç»Ÿå…ˆæ›´æ–°ä»»åŠ¡æ•°é‡',
                '8. ç„¶åæ›´æ–°å·¥è‰ºå‚æ•°',
                '9. æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯ï¼šå·¥è‰ºå‚æ•°å’Œä»»åŠ¡æ•°é‡æ›´æ–°æˆåŠŸ',
                '10. åˆ·æ–°é¡µé¢æ•°æ®ï¼Œæ˜¾ç¤ºæœ€æ–°çš„æ•°é‡ä¿¡æ¯'
            ];
            
            for (let i = 0; i < steps.length; i++) {
                await new Promise(resolve => setTimeout(resolve, 500));
                resultDiv.innerHTML += steps[i] + '\n';
                resultDiv.scrollTop = resultDiv.scrollHeight;
            }
            
            resultDiv.innerHTML += '\nâœ… å·¥ä½œæµç¨‹æ¨¡æ‹Ÿå®Œæˆï¼\n\n';
            resultDiv.innerHTML += 'ğŸ’¡ æç¤ºï¼š\n';
            resultDiv.innerHTML += '- å®é™…ä½¿ç”¨æ—¶ä¼šæœ‰ç”¨æˆ·äº¤äº’ç¡®è®¤\n';
            resultDiv.innerHTML += '- æƒé™æ§åˆ¶ä¼šé™åˆ¶è°å¯ä»¥ä¿®æ”¹ä»»åŠ¡æ•°é‡\n';
            resultDiv.innerHTML += '- æ•°æ®éªŒè¯ä¼šç¡®ä¿æ•°é‡çš„åˆç†æ€§\n';
            resultDiv.innerHTML += '- é”™è¯¯å¤„ç†ä¼šæä¾›å‹å¥½çš„é”™è¯¯æç¤º\n';
            
            resultDiv.className = 'result success';
        }
    </script>
</body>
</html>