<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å·¥å…· - ç®€åŒ–ç‰ˆ</title>
    <style>
        body { 
            padding: 20px; 
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .debug-section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            background: #fafafa;
        }
        .result { 
            background: #f5f5f5; 
            padding: 10px; 
            border-radius: 4px; 
            white-space: pre-wrap; 
            font-family: 'Consolas', monospace; 
            margin-top: 10px; 
            max-height: 400px;
            overflow-y: auto;
        }
        .error { color: #e74c3c; background: #fdf2f2; }
        .success { color: #27ae60; background: #f0f9f4; }
        .warning { color: #f39c12; background: #fef9e7; }
        button { 
            padding: 10px 20px; 
            margin: 5px; 
            cursor: pointer; 
            border: none;
            border-radius: 4px;
            background: #3498db;
            color: white;
            font-size: 14px;
        }
        button:hover { background: #2980b9; }
        .btn-danger { background: #e74c3c; }
        .btn-danger:hover { background: #c0392b; }
        .btn-success { background: #27ae60; }
        .btn-success:hover { background: #229954; }
        .problem-demo { 
            background: #fef2f2; 
            padding: 15px; 
            border-radius: 8px; 
            margin: 10px 0; 
            border-left: 4px solid #ef4444; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0; 
        }
        th, td { 
            border: 1px solid #ddd; 
            padding: 8px; 
            text-align: left; 
        }
        th { 
            background-color: #f2f2f2; 
            font-weight: bold;
        }
        .inconsistent { background-color: #fef2f2; }
        .consistent { background-color: #f0fdf4; }
        input[type="text"] {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        .stat-item {
            flex: 1;
            text-align: center;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
        }
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å·¥å…·</h1>
        
        <div class="problem-demo">
            <h3>ğŸš¨ é—®é¢˜è¯´æ˜</h3>
            <p><strong>ç°è±¡</strong>ï¼šä»»åŠ¡ç®¡ç†é¡µé¢æ˜¾ç¤ºè®¡åˆ’å·²å®Œæˆï¼Œä½†æ³¨å¡‘å·¥è‰ºå‚æ•°é¡µé¢æ˜¾ç¤ºä»»åŠ¡æ•°é‡ä¸ä¸€è‡´ï¼ˆå¦‚ï¼š100/8001ä»¶ï¼‰</p>
            <p><strong>åŸå› </strong>ï¼šå·¥è‰ºå‚æ•°æ•°é‡ä¸ä»»åŠ¡æ•°é‡ä¸åŒæ­¥ï¼Œå¯èƒ½æ˜¯æ•°æ®æ›´æ–°æ—¶æ²¡æœ‰åŒæ­¥æ‰€æœ‰ç›¸å…³è¡¨</p>
            <p><strong>å½±å“</strong>ï¼šæ•°æ®ä¸ä¸€è‡´å¯èƒ½å¯¼è‡´ç”Ÿäº§è®¡åˆ’å’Œå®é™…æ‰§è¡Œå‡ºç°åå·®</p>
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <div class="stat-value" id="totalTasks">-</div>
                <div class="stat-label">æ€»ä»»åŠ¡æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalParams">-</div>
                <div class="stat-label">æ€»å‚æ•°æ•°</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="consistentCount">-</div>
                <div class="stat-label">ä¸€è‡´é¡¹</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="inconsistentCount">-</div>
                <div class="stat-label">ä¸ä¸€è‡´é¡¹</div>
            </div>
        </div>
        
        <div class="debug-section">
            <h3>1. å¿«é€Ÿæ£€æŸ¥ç‰¹å®šè®¡åˆ’</h3>
            <div>
                <label>è®¡åˆ’ç¼–å·: </label>
                <input type="text" id="planCode" value="PLAN-20250625-001" placeholder="è¾“å…¥è®¡åˆ’ç¼–å·">
                <button onclick="checkSpecificPlan()" class="btn-success">æ£€æŸ¥è®¡åˆ’</button>
            </div>
            <div id="specificPlanResult" class="result"></div>
        </div>

        <div class="debug-section">
            <h3>2. å…¨é‡æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥</h3>
            <button onclick="checkAllDataConsistency()" class="btn-danger">æ£€æŸ¥æ‰€æœ‰æ•°æ®</button>
            <button onclick="exportResults()" style="background: #9b59b6;">å¯¼å‡ºç»“æœ</button>
            <div id="allDataResult" class="result"></div>
        </div>

        <div class="debug-section">
            <h3>3. ä¸ä¸€è‡´æ•°æ®è¯¦æƒ…</h3>
            <div id="inconsistencyDetails" style="display: none;">
                <table id="inconsistencyTable">
                    <thead>
                        <tr>
                            <th>åºå·</th>
                            <th>è®¡åˆ’ç¼–å·</th>
                            <th>ä»»åŠ¡ç¼–å·</th>
                            <th>ä»»åŠ¡çŠ¶æ€</th>
                            <th>ä»»åŠ¡æ•°é‡</th>
                            <th>å‚æ•°æ•°é‡</th>
                            <th>å·®å¼‚</th>
                            <th>é—®é¢˜ç±»å‹</th>
                        </tr>
                    </thead>
                    <tbody id="inconsistencyTableBody">
                    </tbody>
                </table>
            </div>
            <div id="inconsistencyResult" class="result"></div>
        </div>

        <div class="debug-section">
            <h3>4. ä¿®å¤å»ºè®®</h3>
            <button onclick="generateFixSuggestions()">ç”Ÿæˆä¿®å¤å»ºè®®</button>
            <div id="fixSuggestionsResult" class="result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080';
        let allTasks = [];
        let allInjectionParams = [];
        let allPlans = [];
        let inconsistencyData = [];
        
        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStats(stats) {
            document.getElementById('totalTasks').textContent = stats.totalTasks || 0;
            document.getElementById('totalParams').textContent = stats.totalParams || 0;
            document.getElementById('consistentCount').textContent = stats.consistentCount || 0;
            document.getElementById('inconsistentCount').textContent = stats.inconsistentCount || 0;
        }
        
        // æ£€æŸ¥ç‰¹å®šè®¡åˆ’
        async function checkSpecificPlan() {
            const planCode = document.getElementById('planCode').value.trim();
            const resultDiv = document.getElementById('specificPlanResult');
            
            if (!planCode) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ è¯·è¾“å…¥è®¡åˆ’ç¼–å·';
                return;
            }
            
            try {
                resultDiv.innerHTML = 'ğŸ” æ£€æŸ¥ç‰¹å®šè®¡åˆ’æ•°æ®ä¸­...\n\n';
                
                // è·å–è®¡åˆ’æ•°æ®
                const plansResponse = await fetch(`${API_BASE}/api/v1/production/plans?page=0&size=1000`);
                if (!plansResponse.ok) {
                    throw new Error(`è·å–è®¡åˆ’æ•°æ®å¤±è´¥: ${plansResponse.status}`);
                }
                const plansData = await plansResponse.json();
                const targetPlan = plansData.content?.find(p => p.planCode === planCode);
                
                if (!targetPlan) {
                    resultDiv.className = 'result error';
                    resultDiv.innerHTML = `âŒ æœªæ‰¾åˆ°è®¡åˆ’ ${planCode}`;
                    return;
                }
                
                // è·å–ç›¸å…³ä»»åŠ¡
                const tasksResponse = await fetch(`${API_BASE}/api/v1/production/tasks?page=0&size=1000`);
                if (!tasksResponse.ok) {
                    throw new Error(`è·å–ä»»åŠ¡æ•°æ®å¤±è´¥: ${tasksResponse.status}`);
                }
                const tasksData = await tasksResponse.json();
                const relatedTasks = tasksData.content?.filter(t => t.planId === targetPlan.id) || [];
                
                // è·å–ç›¸å…³å·¥è‰ºå‚æ•°
                const paramsResponse = await fetch(`${API_BASE}/api/v1/process/injection-params/all?page=0&size=1000`);
                if (!paramsResponse.ok) {
                    throw new Error(`è·å–å·¥è‰ºå‚æ•°å¤±è´¥: ${paramsResponse.status}`);
                }
                const paramsData = await paramsResponse.json();
                const relatedParams = paramsData.content?.filter(p => 
                    relatedTasks.some(t => t.id === p.taskId)
                ) || [];
                
                // åˆ†ææ•°æ®
                let analysis = {
                    planInfo: targetPlan,
                    totalTasks: relatedTasks.length,
                    totalParams: relatedParams.length,
                    taskQuantitySum: relatedTasks.reduce((sum, t) => sum + (t.quantity || 0), 0),
                    paramQuantitySum: relatedParams.reduce((sum, p) => sum + (p.quantity || 0), 0),
                    completedTasks: relatedTasks.filter(t => t.status === 'å·²å®Œæˆ').length,
                    inconsistencies: []
                };
                
                // æ£€æŸ¥æ¯ä¸ªä»»åŠ¡çš„ä¸€è‡´æ€§
                relatedTasks.forEach(task => {
                    const relatedParam = relatedParams.find(p => p.taskId === task.id);
                    if (relatedParam) {
                        if (task.quantity !== relatedParam.quantity) {
                            analysis.inconsistencies.push({
                                taskId: task.id,
                                taskCode: task.taskCode,
                                taskQuantity: task.quantity,
                                paramQuantity: relatedParam.quantity,
                                difference: Math.abs(task.quantity - relatedParam.quantity),
                                status: task.status
                            });
                        }
                    }
                });
                
                resultDiv.className = analysis.inconsistencies.length > 0 ? 'result warning' : 'result success';
                resultDiv.innerHTML = `ğŸ“Š è®¡åˆ’ ${planCode} æ•°æ®æ£€æŸ¥ç»“æœ:\n\n` +
                                     `ğŸ“‹ è®¡åˆ’ä¿¡æ¯:\n` +
                                     `  - è®¡åˆ’æ€»æ•°é‡: ${targetPlan.totalQuantity}\n` +
                                     `  - è®¡åˆ’çŠ¶æ€: ${targetPlan.status}\n\n` +
                                     `ğŸ“ ä»»åŠ¡ä¿¡æ¯:\n` +
                                     `  - å…³è”ä»»åŠ¡æ•°: ${analysis.totalTasks}\n` +
                                     `  - ä»»åŠ¡æ€»æ•°é‡: ${analysis.taskQuantitySum}\n` +
                                     `  - å·²å®Œæˆä»»åŠ¡: ${analysis.completedTasks}\n\n` +
                                     `âš™ï¸ å·¥è‰ºå‚æ•°:\n` +
                                     `  - å·¥è‰ºå‚æ•°æ•°: ${analysis.totalParams}\n` +
                                     `  - å‚æ•°æ€»æ•°é‡: ${analysis.paramQuantitySum}\n\n` +
                                     `ğŸ” ä¸€è‡´æ€§æ£€æŸ¥:\n` +
                                     `  - çŠ¶æ€: ${analysis.inconsistencies.length === 0 ? 'âœ… æ•°æ®ä¸€è‡´' : `âŒ å‘ç°${analysis.inconsistencies.length}ä¸ªä¸ä¸€è‡´`}\n`;
                
                if (analysis.inconsistencies.length > 0) {
                    resultDiv.innerHTML += '\nğŸ“‹ ä¸ä¸€è‡´è¯¦æƒ…:\n';
                    analysis.inconsistencies.forEach((item, index) => {
                        const severity = item.difference > item.taskQuantity * 0.5 ? 'ğŸ”´ ä¸¥é‡' : 'ğŸŸ¡ ä¸€èˆ¬';
                        resultDiv.innerHTML += `${index + 1}. ${severity} - ä»»åŠ¡${item.taskCode || item.taskId}:\n` +
                                              `   ä»»åŠ¡æ•°é‡: ${item.taskQuantity} | å‚æ•°æ•°é‡: ${item.paramQuantity} | å·®å¼‚: ${item.difference}\n` +
                                              `   ä»»åŠ¡çŠ¶æ€: ${item.status}\n\n`;
                    });
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ æ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:\n' + error.message;
                console.error('æ£€æŸ¥ç‰¹å®šè®¡åˆ’å¤±è´¥:', error);
            }
        }
        
        // æ£€æŸ¥æ‰€æœ‰æ•°æ®ä¸€è‡´æ€§
        async function checkAllDataConsistency() {
            const resultDiv = document.getElementById('allDataResult');
            
            try {
                resultDiv.innerHTML = 'ğŸ” æ£€æŸ¥å…¨é‡æ•°æ®ä¸€è‡´æ€§ä¸­...\n\n';
                
                // è·å–æ‰€æœ‰æ•°æ®
                const [tasksResponse, paramsResponse, plansResponse] = await Promise.all([
                    fetch(`${API_BASE}/api/v1/production/tasks?page=0&size=1000`),
                    fetch(`${API_BASE}/api/v1/process/injection-params/all?page=0&size=1000`),
                    fetch(`${API_BASE}/api/v1/production/plans?page=0&size=1000`)
                ]);
                
                // æ£€æŸ¥å“åº”çŠ¶æ€
                if (!tasksResponse.ok) throw new Error(`è·å–ä»»åŠ¡æ•°æ®å¤±è´¥: ${tasksResponse.status}`);
                if (!paramsResponse.ok) throw new Error(`è·å–å‚æ•°æ•°æ®å¤±è´¥: ${paramsResponse.status}`);
                if (!plansResponse.ok) throw new Error(`è·å–è®¡åˆ’æ•°æ®å¤±è´¥: ${plansResponse.status}`);
                
                allTasks = (await tasksResponse.json()).content || [];
                allInjectionParams = (await paramsResponse.json()).content || [];
                allPlans = (await plansResponse.json()).content || [];
                
                // åˆ†ææ•°æ®ä¸€è‡´æ€§
                inconsistencyData = [];
                let totalChecked = 0;
                
                allInjectionParams.forEach(param => {
                    const relatedTask = allTasks.find(t => t.id === param.taskId);
                    totalChecked++;
                    
                    if (!relatedTask) {
                        inconsistencyData.push({
                            type: 'ä»»åŠ¡ä¸å­˜åœ¨',
                            paramId: param.id,
                            taskId: param.taskId,
                            paramQuantity: param.quantity,
                            taskQuantity: 'N/A',
                            planCode: 'N/A',
                            taskCode: 'N/A',
                            taskStatus: 'N/A',
                            difference: 'N/A'
                        });
                    } else if (relatedTask.quantity !== param.quantity) {
                        const plan = allPlans.find(p => p.id === relatedTask.planId);
                        const difference = Math.abs(relatedTask.quantity - param.quantity);
                        inconsistencyData.push({
                            type: difference > relatedTask.quantity * 0.5 ? 'ä¸¥é‡ä¸ä¸€è‡´' : 'æ•°é‡ä¸ä¸€è‡´',
                            paramId: param.id,
                            taskId: param.taskId,
                            taskCode: relatedTask.taskCode,
                            paramQuantity: param.quantity,
                            taskQuantity: relatedTask.quantity,
                            taskStatus: relatedTask.status,
                            planCode: plan?.planCode || 'N/A',
                            difference: difference
                        });
                    }
                });
                
                // æ›´æ–°ç»Ÿè®¡
                const stats = {
                    totalTasks: allTasks.length,
                    totalParams: allInjectionParams.length,
                    consistentCount: totalChecked - inconsistencyData.length,
                    inconsistentCount: inconsistencyData.length
                };
                updateStats(stats);
                
                // æ˜¾ç¤ºç»“æœ
                resultDiv.className = inconsistencyData.length > 0 ? 'result warning' : 'result success';
                resultDiv.innerHTML = `ğŸ“Š å…¨é‡æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ:\n\n` +
                                     `ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯:\n` +
                                     `  - æ€»æ£€æŸ¥é¡¹: ${totalChecked}\n` +
                                     `  - ä¸€è‡´é¡¹: ${totalChecked - inconsistencyData.length}\n` +
                                     `  - ä¸ä¸€è‡´é¡¹: ${inconsistencyData.length}\n` +
                                     `  - ä¸€è‡´æ€§æ¯”ä¾‹: ${Math.round(((totalChecked - inconsistencyData.length) / totalChecked) * 100)}%\n\n`;
                
                if (inconsistencyData.length > 0) {
                    // æŒ‰é—®é¢˜ç±»å‹åˆ†ç»„
                    const byType = inconsistencyData.reduce((acc, item) => {
                        acc[item.type] = (acc[item.type] || 0) + 1;
                        return acc;
                    }, {});
                    
                    resultDiv.innerHTML += 'ğŸ“‹ é—®é¢˜åˆ†å¸ƒ:\n';
                    Object.entries(byType).forEach(([type, count]) => {
                        const icon = type.includes('ä¸¥é‡') ? 'ğŸ”´' : type.includes('ä¸å­˜åœ¨') ? 'âš«' : 'ğŸŸ¡';
                        resultDiv.innerHTML += `  ${icon} ${type}: ${count}ä¸ª\n`;
                    });
                    
                    // æ˜¾ç¤ºè¯¦ç»†è¡¨æ ¼
                    showInconsistencyTable(inconsistencyData);
                } else {
                    resultDiv.innerHTML += 'âœ… æ‰€æœ‰æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ï¼';
                }
                
            } catch (error) {
                resultDiv.className = 'result error';
                resultDiv.innerHTML = 'âŒ æ£€æŸ¥è¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯:\n' + error.message;
                console.error('å…¨é‡æ•°æ®æ£€æŸ¥å¤±è´¥:', error);
            }
        }
        
        // æ˜¾ç¤ºä¸ä¸€è‡´è¯¦æƒ…è¡¨æ ¼
        function showInconsistencyTable(inconsistencies) {
            const detailsDiv = document.getElementById('inconsistencyDetails');
            const tbody = document.getElementById('inconsistencyTableBody');
            
            tbody.innerHTML = '';
            
            inconsistencies.forEach((item, index) => {
                const row = tbody.insertRow();
                row.className = item.type.includes('ä¸¥é‡') ? 'inconsistent' : '';
                
                const typeIcon = item.type.includes('ä¸¥é‡') ? 'ğŸ”´' : 
                               item.type.includes('ä¸å­˜åœ¨') ? 'âš«' : 'ğŸŸ¡';
                
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${item.planCode}</td>
                    <td>${item.taskCode || item.taskId}</td>
                    <td>${item.taskStatus}</td>
                    <td>${item.taskQuantity}</td>
                    <td>${item.paramQuantity}</td>
                    <td>${item.difference}</td>
                    <td>${typeIcon} ${item.type}</td>
                `;
            });
            
            detailsDiv.style.display = 'block';
        }
        
        // ç”Ÿæˆä¿®å¤å»ºè®®
        function generateFixSuggestions() {
            const resultDiv = document.getElementById('fixSuggestionsResult');
            
            if (inconsistencyData.length === 0) {
                resultDiv.className = 'result success';
                resultDiv.innerHTML = 'âœ… æ•°æ®ä¸€è‡´ï¼Œæ— éœ€ä¿®å¤';
                return;
            }
            
            // åˆ†æä¸ä¸€è‡´æ•°æ®
            const seriousIssues = inconsistencyData.filter(i => i.type.includes('ä¸¥é‡'));
            const completedTasks = inconsistencyData.filter(i => i.taskStatus === 'å·²å®Œæˆ');
            const inProgressTasks = inconsistencyData.filter(i => i.taskStatus === 'è¿›è¡Œä¸­');
            const missingTasks = inconsistencyData.filter(i => i.type.includes('ä¸å­˜åœ¨'));
            
            let suggestions = [];
            suggestions.push('ğŸ”§ æ•°æ®ä¿®å¤å»ºè®®:\n');
            
            if (missingTasks.length > 0) {
                suggestions.push(`âš« ä»»åŠ¡ä¸å­˜åœ¨é—®é¢˜ (${missingTasks.length}ä¸ª):`);
                suggestions.push('  - è¿™äº›å·¥è‰ºå‚æ•°å…³è”çš„ä»»åŠ¡å·²è¢«åˆ é™¤');
                suggestions.push('  - å»ºè®®åˆ é™¤è¿™äº›å­¤ç«‹çš„å·¥è‰ºå‚æ•°');
                suggestions.push('  - æˆ–è€…é‡æ–°åˆ›å»ºå¯¹åº”çš„ä»»åŠ¡\n');
            }
            
            if (completedTasks.length > 0) {
                suggestions.push(`âœ… å·²å®Œæˆä»»åŠ¡ (${completedTasks.length}ä¸ª):`);
                suggestions.push('  - å»ºè®®å°†å·¥è‰ºå‚æ•°æ•°é‡åŒæ­¥ä¸ºä»»åŠ¡æ•°é‡');
                suggestions.push('  - å› ä¸ºä»»åŠ¡å·²å®Œæˆï¼Œä»»åŠ¡æ•°é‡åº”è¯¥æ˜¯å‡†ç¡®çš„\n');
            }
            
            if (inProgressTasks.length > 0) {
                suggestions.push(`ğŸ”„ è¿›è¡Œä¸­ä»»åŠ¡ (${inProgressTasks.length}ä¸ª):`);
                suggestions.push('  - éœ€è¦äººå·¥åˆ¤æ–­å“ªä¸ªæ•°é‡æ˜¯æ­£ç¡®çš„');
                suggestions.push('  - å»ºè®®æ£€æŸ¥å®é™…ç”Ÿäº§æƒ…å†µåå†³å®š\n');
            }
            
            if (seriousIssues.length > 0) {
                suggestions.push(`ğŸ”´ ä¸¥é‡ä¸ä¸€è‡´ (${seriousIssues.length}ä¸ª):`);
                suggestions.push('  - æ•°é‡å·®å¼‚è¶…è¿‡50%ï¼Œéœ€è¦ä¼˜å…ˆå¤„ç†');
                suggestions.push('  - å»ºè®®ç«‹å³æ ¸å®æ­£ç¡®çš„æ•°é‡\n');
            }
            
            suggestions.push('ğŸ“‹ å…·ä½“ä¿®å¤æ­¥éª¤:');
            suggestions.push('1. å¤‡ä»½å½“å‰æ•°æ®');
            suggestions.push('2. ç¡®è®¤æ­£ç¡®çš„æ•°é‡æ ‡å‡†');
            suggestions.push('3. æ‰§è¡Œæ‰¹é‡æ•°æ®åŒæ­¥');
            suggestions.push('4. éªŒè¯ä¿®å¤ç»“æœ');
            suggestions.push('5. å»ºç«‹æ•°æ®ä¸€è‡´æ€§ç›‘æ§\n');
            
            suggestions.push('âš ï¸ æ³¨æ„äº‹é¡¹:');
            suggestions.push('- ä¿®å¤å‰è¯·åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯');
            suggestions.push('- é€šçŸ¥ç›¸å…³äººå‘˜æ•°æ®å˜æ›´');
            suggestions.push('- å»ºç«‹å®šæœŸæ•°æ®æ£€æŸ¥æœºåˆ¶');
            
            resultDiv.className = 'result warning';
            resultDiv.innerHTML = suggestions.join('\n');
        }
        
        // å¯¼å‡ºç»“æœ
        function exportResults() {
            if (inconsistencyData.length === 0) {
                alert('æ²¡æœ‰ä¸ä¸€è‡´æ•°æ®å¯å¯¼å‡º');
                return;
            }
            
            let csvContent = "åºå·,è®¡åˆ’ç¼–å·,ä»»åŠ¡ç¼–å·,ä»»åŠ¡çŠ¶æ€,ä»»åŠ¡æ•°é‡,å‚æ•°æ•°é‡,å·®å¼‚,é—®é¢˜ç±»å‹\n";
            
            inconsistencyData.forEach((item, index) => {
                csvContent += `${index + 1},"${item.planCode}","${item.taskCode || item.taskId}","${item.taskStatus}",${item.taskQuantity},${item.paramQuantity},${item.difference},"${item.type}"\n`;
            });
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥ç»“æœ_${new Date().toISOString().slice(0,10)}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥å·¥å…·å·²åŠ è½½');
        };
    </script>
</body>
</html>