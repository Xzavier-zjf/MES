<!DOCTYPE html>
<html>
<head>
    <title>注塑参数 API 调试工具</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <style>
        body { padding: 20px; font-family: Arial, sans-serif; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 8px; }
        .json-display { background: #f5f5f5; padding: 10px; border-radius: 4px; white-space: pre-wrap; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <div id="app">
        <h1>注塑参数 API 调试工具</h1>
        
        <div class="debug-section">
            <h3>API 连接测试</h3>
            <el-button @click="testConnection" type="primary">测试连接</el-button>
            <div v-if="connectionResult" class="json-display" :class="connectionResult.success ? 'success' : 'error'">
                {{ connectionResult.message }}
            </div>
        </div>

        <div class="debug-section">
            <h3>创建注塑参数测试</h3>
            <el-form :model="testData" label-width="120px">
                <el-form-item label="任务ID">
                    <el-input v-model="testData.taskId" placeholder="输入任务ID" />
                </el-form-item>
                <el-form-item label="计划ID">
                    <el-input v-model="testData.planId" placeholder="输入计划ID" />
                </el-form-item>
                <el-form-item label="设备ID">
                    <el-input v-model="testData.deviceId" placeholder="输入设备ID" />
                </el-form-item>
                <el-form-item label="数量">
                    <el-input-number v-model="testData.quantity" :min="1" />
                </el-form-item>
                <el-form-item label="注塑压力">
                    <el-input-number v-model="testData.pressure" :precision="1" />
                </el-form-item>
                <el-form-item label="注塑速度">
                    <el-input-number v-model="testData.injectionSpeed" :precision="1" />
                </el-form-item>
                <el-form-item label="保压时间">
                    <el-input-number v-model="testData.holdTime" :precision="1" />
                </el-form-item>
                <el-form-item label="冷却时间">
                    <el-input-number v-model="testData.coolingTime" :precision="1" />
                </el-form-item>
                <el-form-item label="模具温度">
                    <el-input-number v-model="testData.moldTemperature" :precision="1" />
                </el-form-item>
                <el-form-item label="料筒温度">
                    <el-input-number v-model="testData.materialTemperature" :precision="1" />
                </el-form-item>
            </el-form>
            
            <el-button @click="testCreate" type="success" :loading="creating">测试创建</el-button>
            
            <div v-if="createResult" class="json-display" :class="createResult.success ? 'success' : 'error'">
                <strong>请求数据:</strong>
                {{ JSON.stringify(createResult.requestData, null, 2) }}
                
                <strong>响应结果:</strong>
                {{ createResult.message }}
                
                <div v-if="createResult.response">
                    {{ JSON.stringify(createResult.response, null, 2) }}
                </div>
            </div>
        </div>

        <div class="debug-section">
            <h3>获取现有参数</h3>
            <el-button @click="fetchParams" type="info">获取参数列表</el-button>
            <div v-if="paramsList" class="json-display">
                {{ JSON.stringify(paramsList, null, 2) }}
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref } = Vue;
        
        const API_BASE_URL = 'http://localhost:8080';
        
        createApp({
            setup() {
                const connectionResult = ref(null);
                const createResult = ref(null);
                const paramsList = ref(null);
                const creating = ref(false);
                
                const testData = ref({
                    taskId: 'TASK001',
                    planId: 'PLAN001',
                    deviceId: 'INJ001',
                    quantity: 100,
                    pressure: 150.0,
                    injectionSpeed: 50.0,
                    holdTime: 10.0,
                    coolingTime: 30.0,
                    moldTemperature: 180.0,
                    materialTemperature: 220.0
                });
                
                const testConnection = async () => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/v1/process/injection-params/all?page=0&size=1`);
                        if (response.ok) {
                            connectionResult.value = {
                                success: true,
                                message: `连接成功! 状态码: ${response.status}`
                            };
                        } else {
                            connectionResult.value = {
                                success: false,
                                message: `连接失败! 状态码: ${response.status}, 错误: ${response.statusText}`
                            };
                        }
                    } catch (error) {
                        connectionResult.value = {
                            success: false,
                            message: `连接错误: ${error.message}`
                        };
                    }
                };
                
                const testCreate = async () => {
                    creating.value = true;
                    try {
                        const requestData = {
                            taskId: testData.value.taskId,
                            planId: testData.value.planId,
                            deviceId: testData.value.deviceId,
                            quantity: parseInt(testData.value.quantity),
                            pressure: parseFloat(testData.value.pressure),
                            injectionSpeed: parseFloat(testData.value.injectionSpeed),
                            holdTime: parseFloat(testData.value.holdTime),
                            coolingTime: parseFloat(testData.value.coolingTime),
                            moldTemperature: parseFloat(testData.value.moldTemperature),
                            materialTemperature: parseFloat(testData.value.materialTemperature)
                        };
                        
                        const response = await fetch(`${API_BASE_URL}/api/v1/process/injection-params`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestData)
                        });
                        
                        const responseText = await response.text();
                        let responseData = null;
                        
                        try {
                            responseData = JSON.parse(responseText);
                        } catch (e) {
                            responseData = responseText;
                        }
                        
                        createResult.value = {
                            success: response.ok,
                            requestData: requestData,
                            message: response.ok ? '创建成功!' : `创建失败! 状态码: ${response.status}`,
                            response: responseData
                        };
                        
                    } catch (error) {
                        createResult.value = {
                            success: false,
                            requestData: testData.value,
                            message: `请求错误: ${error.message}`,
                            response: null
                        };
                    } finally {
                        creating.value = false;
                    }
                };
                
                const fetchParams = async () => {
                    try {
                        const response = await fetch(`${API_BASE_URL}/api/v1/process/injection-params/all?page=0&size=10`);
                        if (response.ok) {
                            paramsList.value = await response.json();
                        } else {
                            paramsList.value = { error: `获取失败: ${response.status} ${response.statusText}` };
                        }
                    } catch (error) {
                        paramsList.value = { error: error.message };
                    }
                };
                
                return {
                    connectionResult,
                    createResult,
                    paramsList,
                    creating,
                    testData,
                    testConnection,
                    testCreate,
                    fetchParams
                };
            }
        }).use(ElementPlus).mount('#app');
    </script>
</body>
</html>