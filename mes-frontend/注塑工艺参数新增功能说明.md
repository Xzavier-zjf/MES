# 注塑工艺参数新增功能说明

## 🎯 **功能概述**

为注塑工艺参数页面添加了"新增注塑工艺"功能，允许用户创建新的注塑工艺参数配置，完善了注塑工艺管理的完整流程。

## ✅ **新增功能特性**

### 1. **新增工艺参数按钮**
- 位置：筛选区域右侧
- 样式：绿色成功按钮
- 功能：打开新增注塑工艺参数对话框

### 2. **智能表单设计**

#### 基础信息配置（仅新增模式显示）：
- **关联计划**：选择相关的生产计划
- **关联任务**：选择注塑工序的任务
- **关联设备**：选择注塑设备（自动筛选INJ开头的设备）
- **生产数量**：设置工艺参数对应的生产数量

#### 工艺参数配置：
- **注塑压力**：0-1000 MPa，精度0.1
- **注塑速度**：0-500 mm/s，精度0.1
- **保压时间**：0-60 秒，精度0.1
- **冷却时间**：0-300 秒，精度0.1
- **模具温度**：0-500 ℃，精度0.1
- **料筒温度**：0-400 ℃，精度0.1

#### 附加信息：
- **备注信息**：可选的工艺说明，最多500字符

### 3. **表单验证机制**

#### 必填字段验证：
```javascript
- 关联计划：必须选择
- 关联任务：必须选择
- 关联设备：必须选择
- 生产数量：必须大于0
- 所有工艺参数：必须填写且在合理范围内
```

#### 数值范围验证：
```javascript
- 注塑压力：0-1000 MPa
- 注塑速度：0-500 mm/s
- 保压时间：0-60 秒
- 冷却时间：0-300 秒
- 模具温度：0-500 ℃
- 料筒温度：0-400 ℃
- 生产数量：1-10000 件
```

### 4. **智能数据筛选**

#### 注塑任务筛选：
- 自动筛选工序类型为"注塑"的任务
- 显示任务编号和对应数量
- 支持搜索和过滤

#### 注塑设备筛选：
- 优先显示设备编号以"INJ"开头的设备
- 筛选名称包含"注塑"的设备
- 筛选类型为"注塑"的设备

### 5. **用户体验优化**

#### 表单布局：
- 分区域显示：基础信息、工艺参数、备注信息
- 响应式布局：工艺参数采用两列布局
- 单位显示：每个数值输入框后显示对应单位

#### 交互优化：
- 加载状态：提交时显示加载动画
- 成功提示：操作成功后显示友好提示
- 错误处理：详细的错误信息提示
- 表单重置：关闭对话框时清除验证状态

## 🔄 **工作流程**

### 新增工艺参数流程：
```
1. 点击"新增注塑工艺"按钮
2. 选择关联的计划、任务、设备
3. 设置生产数量
4. 配置工艺参数（压力、速度、时间、温度等）
5. 填写备注信息（可选）
6. 表单验证通过后提交
7. 创建成功，更新列表显示
```

### 编辑工艺参数流程：
```
1. 点击表格中的"录入工艺"按钮
2. 弹窗显示现有参数（基础信息不可编辑）
3. 修改工艺参数
4. 提交更新
5. 更新成功，刷新列表
```

## 🛠️ **技术实现**

### 1. **API集成**
```javascript
// 使用现有的创建API
import { createInjectionParam } from '@/api/injection'

// 创建工艺参数
const newParam = await createInjectionParam(paramData)
```

### 2. **数据验证**
```javascript
// 表单验证规则
const formRules = {
  planId: [{ required: true, message: '请选择生产计划' }],
  taskId: [{ required: true, message: '请选择注塑任务' }],
  pressure: [{ 
    required: true, 
    type: 'number', 
    min: 0, 
    max: 1000, 
    message: '注塑压力范围: 0-1000 MPa' 
  }]
  // ... 其他验证规则
}
```

### 3. **智能筛选**
```javascript
// 筛选注塑设备
availableInjectionDevices.value = devices.filter(device => 
  device.deviceCode?.startsWith('INJ') || 
  device.name?.includes('注塑') ||
  device.type === '注塑'
)
```

## 📊 **功能对比**

| 功能 | 修改前 | 修改后 |
|------|--------|--------|
| 新增工艺参数 | ❌ 不支持 | ✅ 完整支持 |
| 关联数据选择 | ❌ 无 | ✅ 计划/任务/设备选择 |
| 表单验证 | ❌ 基础验证 | ✅ 完整验证规则 |
| 用户体验 | ⚠️ 基础 | ✅ 优化的UI/UX |
| 数据完整性 | ⚠️ 部分 | ✅ 完整的数据关联 |

## 🎨 **界面展示**

### 新增按钮位置：
```
[筛选] [重置] [新增注塑工艺] [验证数量逻辑]
```

### 对话框标题：
- 新增模式：`新增注塑工艺参数`
- 编辑模式：`编辑注塑工艺参数`

### 表单分区：
```
┌─ 基础信息 ─────────────────┐
│ 关联计划: [下拉选择]        │
│ 关联任务: [下拉选择]        │
│ 关联设备: [下拉选择]        │
│ 生产数量: [数字输入]        │
└─────────────────────────┘

┌─ 工艺参数 ─────────────────┐
│ 注塑压力: [___] MPa        │
│ 注塑速度: [___] mm/s       │
│ 保压时间: [___] 秒         │
│ 冷却时间: [___] 秒         │
│ 模具温度: [___] ℃          │
│ 料筒温度: [___] ℃          │
└─────────────────────────┘

┌─ 备注信息 ─────────────────┐
│ [多行文本输入框]           │
└─────────────────────────┘
```

## 🔍 **数据验证示例**

### 成功创建示例：
```javascript
{
  planId: 1,
  taskId: 5,
  deviceId: 3,
  quantity: 1000,
  pressure: 85.5,
  injectionSpeed: 120.0,
  holdTime: 15.0,
  coolingTime: 45.0,
  moldTemperature: 180.0,
  materialTemperature: 220.0,
  remarks: "高精度产品工艺参数"
}
```

### 验证失败示例：
```javascript
// 压力超出范围
pressure: 1200 // ❌ 超出0-1000范围

// 缺少必填字段
taskId: null // ❌ 必须选择任务

// 数量不合理
quantity: 0 // ❌ 必须大于0
```

## 🚀 **使用建议**

### 1. **操作流程建议**
1. 先在计划管理页面创建生产计划
2. 在任务管理页面创建注塑工序任务
3. 在设备监控页面确认注塑设备状态
4. 在注塑工艺参数页面创建工艺参数

### 2. **参数设置建议**
- 根据产品材料特性设置温度参数
- 根据产品复杂度调整压力和速度
- 考虑生产效率设置时间参数
- 添加详细的备注信息便于后续维护

### 3. **数据管理建议**
- 定期使用"验证数量逻辑"功能检查数据一致性
- 保持工艺参数与实际生产任务的同步
- 及时更新设备状态和工艺参数

通过这个新增功能，注塑工艺参数管理现在具备了完整的CRUD操作能力，大大提升了系统的实用性和用户体验。