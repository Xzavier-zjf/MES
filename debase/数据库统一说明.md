# MES项目数据库统一说明

## 变更概述
将原本分散在4个独立数据库中的表统一合并到一个名为"MES"的数据库中，简化数据库管理和维护。

## 原数据库结构
- `auth_service_db` - 认证服务数据库
  - `user` 表 - 用户信息
- `equipment_service_db` - 设备服务数据库  
  - `device` 表 - 设备信息
- `process_service_db` - 工艺服务数据库
  - `injection_param` 表 - 注塑工艺参数
  - `print_pattern` 表 - 印刷图案信息
- `production_service_db` - 生产服务数据库
  - `production_plan` 表 - 生产计划
  - `production_task` 表 - 生产任务

## 统一后数据库结构
- `MES` - 统一数据库
  - `user` 表 - 用户信息 (来自auth_service_db)
  - `device` 表 - 设备信息 (来自equipment_service_db)
  - `injection_param` 表 - 注塑工艺参数 (来自process_service_db)
  - `print_pattern` 表 - 印刷图案信息 (来自process_service_db)
  - `production_plan` 表 - 生产计划 (来自production_service_db)
  - `production_task` 表 - 生产任务 (来自production_service_db)

## 配置文件修改
已修改以下配置文件中的数据库连接URL：

1. **认证服务** - `MES-demo/services/auth-service/src/main/resources/application.yml`
   - 原: `jdbc:mysql://localhost:3306/auth_service_db`
   - 新: `jdbc:mysql://localhost:3306/MES`

2. **设备服务** - `MES-demo/services/service-equipment/src/main/resources/application.yml`
   - 原: `jdbc:mysql://localhost:3306/equipment_service_db`
   - 新: `jdbc:mysql://localhost:3306/MES`

3. **工艺服务** - `MES-demo/services/service-process/src/main/resources/application.yml`
   - 原: `jdbc:mysql://localhost:3306/process_service_db`
   - 新: `jdbc:mysql://localhost:3306/MES`

4. **生产服务** - `MES-demo/services/service-production/src/main/resources/application.yml`
   - 原: `jdbc:mysql://localhost:3306/production_service_db`
   - 新: `jdbc:mysql://localhost:3306/MES`

## 数据迁移步骤

### 1. 在Navicat中执行数据库创建
使用提供的 `MES_unified_database.sql` 文件在Navicat中执行，该文件将：
- 创建MES数据库
- 创建所有必要的表结构
- 导入所有现有数据

### 2. 验证数据完整性
执行SQL后，请验证以下内容：
- 所有表都已正确创建
- 数据已完整迁移
- 索引和约束都已正确设置

### 3. 重启服务
修改配置文件后，需要重启所有微服务以使新的数据库连接生效。

## 注意事项
1. **数据备份**: 在执行迁移前，请确保已备份原有数据库
2. **表结构**: 所有表结构和数据保持不变，只是数据库名称发生变化
3. **服务重启**: 配置修改后需要重启所有相关服务
4. **连接池**: 数据库连接池配置保持不变
5. **权限**: 确保数据库用户对MES数据库有完整的读写权限

## 优势
- **简化管理**: 只需管理一个数据库实例
- **减少连接**: 降低数据库连接数量
- **便于维护**: 统一的备份和恢复策略
- **数据一致性**: 更容易保证跨服务的数据一致性
- **监控简化**: 统一的数据库监控和性能调优

## 后续建议
1. 考虑添加数据库连接池监控
2. 设置合适的数据库备份策略
3. 根据实际使用情况调整连接池参数
4. 考虑添加数据库读写分离（如果需要）